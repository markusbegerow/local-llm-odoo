<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="local_llm_odoo.LLMChatWidget" owl="1">
        <div class="llm-chat-container">
            <!-- Sidebar -->
            <div t-if="state.isSidebarOpen" class="llm-chat-sidebar">
                <div class="llm-sidebar-header">
                    <h3>Conversations</h3>
                    <button class="btn btn-primary btn-sm" t-on-click="newConversation">
                        <i class="fa fa-plus"/> New Chat
                    </button>
                </div>
                <div class="llm-conversations-list">
                    <t t-foreach="state.conversations" t-as="conv" t-key="conv.id">
                        <div class="llm-conversation-item"
                             t-att-class="{'active': state.currentConversation?.id === conv.id}"
                             t-on-click="() => this.selectConversation(conv)">
                            <div class="llm-conversation-title" t-esc="conv.name"/>
                            <div class="llm-conversation-meta">
                                <span t-esc="conv.message_count"/> messages
                            </div>
                        </div>
                    </t>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="llm-chat-main">
                <!-- Header -->
                <div class="llm-chat-header">
                    <button class="btn btn-sm btn-secondary" t-on-click="toggleSidebar">
                        <i class="fa fa-bars"/>
                    </button>
                    <h3 t-if="state.currentConversation">
                        <t t-esc="state.currentConversation.name"/>
                    </h3>
                    <h3 t-else="">Local LLM Chat</h3>
                </div>

                <!-- Messages -->
                <div class="llm-messages-container">
                    <t t-if="state.messages.length === 0">
                        <div class="llm-empty-state">
                            <i class="fa fa-comments fa-4x"/>
                            <h4>Start a conversation</h4>
                            <p>Ask me anything! I'm here to help with your Odoo tasks.</p>
                        </div>
                    </t>
                    <t t-else="">
                        <t t-foreach="state.messages" t-as="message" t-key="message_index">
                            <div class="llm-message" t-att-class="'llm-message-' + message.role">
                                <div class="llm-message-avatar">
                                    <i t-if="message.role === 'user'" class="fa fa-user"/>
                                    <i t-else="" class="fa fa-robot"/>
                                </div>
                                <div class="llm-message-content">
                                    <div class="llm-message-role" t-esc="message.role"/>
                                    <div class="llm-message-text" t-esc="message.content"/>
                                    <div class="llm-message-time" t-esc="formatDate(message.create_date)"/>
                                </div>
                            </div>
                        </t>
                    </t>
                    <div t-ref="messagesEnd"/>
                </div>

                <!-- Input Area -->
                <div class="llm-input-container">
                    <textarea
                        class="llm-input"
                        placeholder="Type your message... (Enter to send, Shift+Enter for new line)"
                        t-model="state.inputMessage"
                        t-on-keydown="onKeydown"
                        t-att-disabled="state.isLoading"
                        rows="3"/>
                    <button
                        class="btn btn-primary llm-send-btn"
                        t-on-click="sendMessage"
                        t-att-disabled="state.isLoading or !state.inputMessage.trim()">
                        <i t-if="state.isLoading" class="fa fa-spinner fa-spin"/>
                        <i t-else="" class="fa fa-paper-plane"/>
                    </button>
                </div>
            </div>
        </div>
    </t>
</templates>
